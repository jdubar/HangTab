<?xml version="1.0" encoding="utf-8" ?>
<views:ContentPageBase
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:HangTab.Views.Controls"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:views="clr-namespace:HangTab.Views.Base"
    xmlns:vm="clr-namespace:HangTab.ViewModels"
    x:Class="HangTab.Views.CurrentWeekOverviewPage"
    x:DataType="vm:CurrentWeekOverviewViewModel"
    x:Name="PageSelf">
    
    <Shell.TitleView>
        <Label
            Text="{Binding PageTitle}"
            Style="{StaticResource PageTitle}" />
    </Shell.TitleView>
    
    <ContentPage.Content>
        <Grid
            RowDefinitions="*,30,Auto,Auto">
            
            <!--This Week's Bowler List & Splash-->
            <Grid
                Grid.Row="0">
                
                <!--Bus Ride Splash-->
                <Image
                    Source="bus_splash.png"
                    HeightRequest="300"
                    ZIndex="2"
                    IsVisible="{Binding PlayBusRideAnimation}"
                    HorizontalOptions="Center"
                    VerticalOptions="Center" />
                
                <!--Loading Indicator-->
                <controls:LoadingIndicator
                    ShowLoadingIndicator="{Binding IsLoading}"
                    LoadingText="{Binding LoadingText}" />

                <!--Bowler List-->
                <CollectionView
                    x:Name="collectionView"
                    ItemsSource="{Binding CurrentWeekBowlers}"
                    SelectedItem="{Binding SelectedBowler}">

                    <CollectionView.ItemTemplate>
                        <DataTemplate
                            x:DataType="vm:CurrentWeekListItemViewModel">
                            
                            <VerticalStackLayout>
                                <SwipeView>
                                    <SwipeView.LeftItems>
                                        <SwipeItems>
                                            
                                            <!--Active Swipe Item-->
                                            <SwipeItemView
                                                IsVisible="{Binding ShowActiveOption}"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CurrentWeekOverviewViewModel}}, Path=SetBowlerStatusToActiveCommand}"
                                                CommandParameter="{Binding .}">
                                                <Border
                                                    StrokeShape="RoundRectangle 5,0,5,0"
                                                    WidthRequest="70"
                                                    BackgroundColor="{DynamicResource Success}">
                                                    <Grid
                                                        RowDefinitions="40,Auto"
                                                        VerticalOptions="Center"
                                                        HorizontalOptions="Center">
                                                        <Image
                                                            Aspect="AspectFill"
                                                            WidthRequest="40"
                                                            HorizontalOptions="Center"
                                                            Source="person.png" />
                                                        <Label
                                                            Grid.Row="1"
                                                            Text="Active"
                                                            FontSize="14"
                                                            FontAttributes="Bold"
                                                            TextColor="{DynamicResource PrimaryContrastTextColor}"
                                                            HorizontalOptions="Center" />
                                                    </Grid>
                                                </Border>
                                            </SwipeItemView>
                                            
                                            <!--Blind Swipe Item-->
                                            <SwipeItemView
                                                IsVisible="{Binding ShowBlindOption}"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CurrentWeekOverviewViewModel}}, Path=SetBowlerStatusToBlindCommand}"
                                                CommandParameter="{Binding .}">
                                                <Border
                                                    StrokeShape="RoundRectangle 5,0,5,0"
                                                    WidthRequest="70"
                                                    BackgroundColor="{DynamicResource Error}">
                                                    <Grid
                                                        RowDefinitions="40,Auto"
                                                        VerticalOptions="Center"
                                                        HorizontalOptions="Center">
                                                        <Image
                                                            Aspect="AspectFill"
                                                            WidthRequest="40"
                                                            HorizontalOptions="Center"
                                                            Source="person_off.png" />
                                                        <Label
                                                            Grid.Row="1"
                                                            Text="Blind"
                                                            FontSize="14"
                                                            FontAttributes="Bold"
                                                            TextColor="{DynamicResource PrimaryContrastTextColor}"
                                                            HorizontalOptions="Center" />
                                                    </Grid>
                                                </Border>
                                            </SwipeItemView>
                                            
                                            <!--Use Sub Swipe Item-->
                                            <SwipeItemView
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CurrentWeekOverviewViewModel}}, Path=SetBowlerStatusToUsingSubCommand}"
                                                CommandParameter="{Binding .}">
                                                <Border
                                                    WidthRequest="70"
                                                    BackgroundColor="{DynamicResource SecondaryColor}">
                                                    <Grid
                                                        RowDefinitions="40,Auto"
                                                        VerticalOptions="Center"
                                                        HorizontalOptions="Center">
                                                        <Image
                                                            Aspect="AspectFill"
                                                            WidthRequest="40"
                                                            HorizontalOptions="Center"
                                                            Source="switch_account.png" />
                                                        <Label
                                                            Grid.Row="1"
                                                            Text="Sub"
                                                            FontSize="14"
                                                            FontAttributes="Bold"
                                                            TextColor="{DynamicResource PrimaryContrastTextColor}"
                                                            HorizontalOptions="Center" />
                                                    </Grid>
                                                </Border>
                                            </SwipeItemView>
                                        </SwipeItems>
                                    </SwipeView.LeftItems>
                                    
                                    <Border
                                        Margin="5,2"
                                        Style="{StaticResource RoundedCornerBorder}">
                                        <Grid
                                            x:Name="grid"
                                            Padding="5"
                                            ColumnDefinitions="Auto,*,Auto">
                                            
                                            <!--Avatar Image-->
                                            <controls:UserImage
                                                ImageUrl="{Binding ImageUrl}"
                                                Initials="{Binding Initials}"
                                                ShowSub="{Binding IsSub}" />
                                
                                            <!--Full Name-->
                                            <Label
                                                Grid.Column="1"
                                                VerticalOptions="Center"
                                                FontSize="Large"
                                                Text="{Binding Name}"
                                                Style="{StaticResource BowlerName}" />
                            
                                            <!--Hanging Stepper-->
                                            <controls:Stepper 
                                                Grid.Column="2"
                                                IsControlEnabled="{Binding EnableStepper}"
                                                Value="{Binding HangCount}" />
                                    
                                        </Grid>
                                    </Border>
                                </SwipeView>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                    
                    <!--Empty List Message-->
                    <CollectionView.EmptyView>
                        <controls:EmptyCollectionMessage
                            IsVisible="{Binding LoadingComplete}"
                            Message="Your lineup is empty"
                            SubMessage="Create bowlers on the Bowlers page" />
                    </CollectionView.EmptyView>
                    
                </CollectionView>
            </Grid>
            
            <!--Total hangings this week-->
            <Grid
                Grid.Row="1">
                <Grid
                    ColumnDefinitions="Auto,*">
                    <Border
                        Grid.Column="0"
                        Grid.ColumnSpan="3"
                        Style="{StaticResource RoundedCornerBorder}"
                        ZIndex="1">
                        
                        <HorizontalStackLayout>
                            <!--Group Total-->
                            <Label
                                Text="{Binding TeamHangTotal, Mode=OneWay, StringFormat='Total Hangings: {0}'}"
                                Style="{StaticResource TotalHangings}" />
                        </HorizontalStackLayout>
                    </Border>
                    
                    <Image
                        Grid.Column="1"
                        Source="popper_anim.gif"
                        IsVisible="{Binding PlayPopperAnimation}"
                        HeightRequest="40"
                        HorizontalOptions="Center"
                        Margin="-50,0,0,5"
                        IsAnimationPlaying="{Binding PlayPopperAnimation}"
                        ZIndex="2" />
                </Grid>
            </Grid>
        
            <!--This Week's Bus Ride Count-->
            <Grid
                Grid.Row="2"
                ColumnDefinitions="*,Auto">
                
                <Border
                    Style="{StaticResource RoundedCornerBorder}">
                    <Grid
                        ColumnDefinitions="Auto,*,Auto">
                        <Image
                            Grid.Column="0"
                            Source="school_bus.png"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Margin="15,0,20,10"
                            HeightRequest="80" />

                        <Label
                            Grid.Column="1"
                            Text="Bus Rides"
                            Style="{StaticResource BusRides}" />
                
                        <!--Bus Ride Stepper-->
                        <controls:Stepper 
                            Grid.Column="3"
                            IsControlEnabled="{Binding BusRideStepperEnabled}"
                            Value="{Binding BusRides}" />

                    </Grid>
                </Border>
            </Grid>
        
            <!--Submit Button-->
            <StackLayout
                Grid.Row="3"
                Grid.Column="0"
                Margin="5">
                <Button
                    IsEnabled="{Binding IsEnableCompleteWeek}"
                    Style="{StaticResource PrimaryButton}"
                    Text="{Binding WeekNumber, StringFormat='Complete week {0}'}" />
            </StackLayout>
        </Grid>
    </ContentPage.Content>
</views:ContentPageBase>