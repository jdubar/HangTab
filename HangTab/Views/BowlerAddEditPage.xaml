<?xml version="1.0" encoding="utf-8" ?>
<views:ContentPageBase
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:views="clr-namespace:HangTab.Views"
    xmlns:vm="clr-namespace:HangTab.ViewModels"
    xmlns:dataAnnotations="clr-namespace:System.ComponentModel.DataAnnotations;assembly=System.ComponentModel.Annotations"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Class="HangTab.Views.BowlerAddEditPage"
    x:DataType="vm:BowlerAddEditViewModel">
    
    <Shell.TitleView>
        <Grid>
            <Label Text="{Binding PageTitle}"
                   HorizontalOptions="Start"
                   VerticalOptions="Center"
                   TextColor="{StaticResource PrimaryDark}"
                   FontSize="Medium"
                   FontAttributes="Bold" />
            <ImageButton
                Aspect="Center"
                HorizontalOptions="End"
                VerticalOptions="Center"
                CornerRadius="100"
                Margin="10,0"
                IsVisible="{Binding ShowDeleteButton}"
                Command="{Binding DeleteBowlerCommand}">
                <ImageButton.Source>
                    <FontImageSource
                        FontFamily="MaterialIcons"
                        Glyph="{StaticResource delete}"
                        Size="30"/>
                </ImageButton.Source>
            </ImageButton>
        </Grid>
    </Shell.TitleView>
    
    <Grid
        RowDefinitions="Auto,Auto,Auto,*,Auto"
        RowSpacing="10"
        HorizontalOptions="FillAndExpand"
        VerticalOptions="FillAndExpand">
            
        <!--Avatar Image/Update Avatar Button-->
        <Border
            Grid.Row="0"
            Grid.ColumnSpan="3"
            BackgroundColor="{StaticResource Primary}"
            ZIndex="2">
            <Grid>
                <!--Update Avatar Button-->
                <ImageButton
                    Aspect="Center"
                    BackgroundColor="{StaticResource PrimaryDark}"
                    HorizontalOptions="Center"
                    VerticalOptions="Center"
                    CornerRadius="100"
                    WidthRequest="70"
                    HeightRequest="70"
                    Margin="140,140,0,0"
                    ZIndex="2"
                    Command="{Binding ShowAvatarOptionsBottomSheetCommand}"
                    CommandParameter="{x:Reference NameEntry}">
                    <ImageButton.Source>
                        <FontImageSource
                            FontFamily="MaterialIcons"
                            Glyph="{StaticResource add_a_photo}"
                            Size="40"/>
                    </ImageButton.Source>
                </ImageButton>
                
                <!--Avatar Image-->
                <toolkit:AvatarView
                    ImageSource="{Binding ImageUrl}"
                    Style="{StaticResource CachedImageProfile}"
                    Text="{Binding Initials}"
                    FontSize="42"
                    WidthRequest="200"
                    HeightRequest="200"
                    CornerRadius="100"
                    ZIndex="1" />
            </Grid>
        </Border>
            
        <!--Bowler Name Entry-->
        <VerticalStackLayout
            Grid.Row="1"
            Margin="10,0"
            Spacing="10">
            <VerticalStackLayout>
                <Label
                    Text="Bowler Name"
                    FontAttributes="Bold" />
                <Border
                    StrokeShape="RoundRectangle  5"
                    Margin="0,5">
                    <Entry
                        x:Name="NameEntry"
                        ClearButtonVisibility="WhileEditing"
                        Placeholder="Bowler's full name"
                        Keyboard="Text"
                        ReturnType="Done"
                        Text="{Binding Name}" />
                </Border>
            </VerticalStackLayout>
        </VerticalStackLayout>
            
        <!--Substitute Bowler Switch-->
        <Grid
            Grid.Row="2"
            RowDefinitions="Auto"
            ColumnDefinitions="*,5*"
            Margin="10,0">
            
            <Switch
                Grid.Column="0"
                IsToggled="{Binding IsSub, Mode=TwoWay}"
                OnColor="{DynamicResource Success}"
                ThumbColor="{StaticResource Primary}"
                HorizontalOptions="Center"
                VerticalOptions="Center" />
            <Label
                Grid.Column="1"
                Text="Substitute Bowler"
                VerticalOptions="Center"
                FontSize="Medium" />
        </Grid>
            
        <!--Validation Errors-->
        <VerticalStackLayout
            Grid.Row="3"
            Grid.Column="0"
            Margin="10"
            BindableLayout.ItemsSource="{Binding Errors}">
            <BindableLayout.ItemTemplate>
                <DataTemplate x:DataType="dataAnnotations:ValidationResult">
                    <Label
                        Style="{StaticResource ErrorLabelStyle}"
                        Text="{Binding ErrorMessage}" />
                </DataTemplate>
            </BindableLayout.ItemTemplate>
        </VerticalStackLayout>
            
        <!--Submit Button-->
        <StackLayout
            Grid.Row="4"
            Grid.Column="0"
            Margin="10">
            <Button
                CornerRadius="20"
                Text="Save Changes"
                HorizontalOptions="FillAndExpand"
                Command="{Binding SubmitCommand}" />
        </StackLayout>
    </Grid>
</views:ContentPageBase>